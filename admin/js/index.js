!function(e){var t={};function n(r){if(t[r])return t[r].exports;var l=t[r]={i:r,l:!1,exports:{}};return e[r].call(l.exports,l,l.exports,n),l.l=!0,l.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)n.d(r,l,function(t){return e[t]}.bind(null,l));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);class r{getParent(){return this.btn.parentNode}getGrand(){return this.getParent().parentNode}}class l{generateElement(e){let t=this.generateByNameOfEl(e.el,e.children);for(let n of e.options)t.setAttribute(n.name,n.value);return t}generateByNameOfEl(e,t){let n=document.createElement(e);for(let e of this.getMarkup(t))void 0!==e&&n.appendChild(e);return n}getMarkup(e){let t=!0,n=this.generateMarkup(e),r=[];for(;t;){let e=n.next();try{t=!e.done,r.push(e.value)}catch(e){}}return r}*generateMarkup(e){for(let t of e){let e=this.prepareChildOfEl(t);if(t.children)for(let n of t.children)e.appendChild(this.prepareChildOfEl(n));yield e}}prepareChildOfEl(e){let t=document.createElement(e.el),n=document.createTextNode(e.text?e.text:""),r=e.options?e.options:[];e.text&&t.appendChild(n);for(let e of r)t.setAttribute(e.name,e.value);return e.event&&t.addEventListener(e.event,e.callBack),t}}class s{usualStringIsCorrect(e){let t=/[а-яА-Яa-zA-Z0-9\s\.\,]/,n=!0;for(let r of e)n=n&&t.test(r);return n}dateIsCorrect(e){return/\d{4}\-\d{1,2}\-\d{1,2}/.test(e)}urlIsCorrect(e){return/\b(?:(?:https?|ftp):\/\/|www\.)[-a-z0-9+&@#\/%?=~_|!:,.;]*[-a-z0-9+&@#\/%=~_|]/i.test(e)}}class a{post(e,t){let n={method:"POST",file:e,data:t};return this.sendRequest(n)}get(e,t){let n={method:"GET",file:e,data:t};return this.sendRequest(n)}sendRequest(e){return new Promise((t,n)=>{let r,l=new XMLHttpRequest;l.open(e.method,e.file),"POST"==e.method&&l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.send(e.data),l.onreadystatechange=(()=>{4==l.readyState&&200==l.status&&((r=JSON.parse(l.responseText)).errorMessage?n(r.errorMessage):t(r))})})}}const i=new class extends r{delete(e){this.btn=e,this.getGrand().removeChild(this.getParent())}},o=new class extends r{constructor(){super(...arguments),this.g=new l}insert(e){this.btn=e,this.getParent().insertBefore(this.getUrlInput(),this.btn)}getUrlInput(){return this.g.generateByNameOfEl(p.el,p.children)}},u=new class{constructor(){this.http=new a,this.ic=new s,this.PATH=document.location.origin+"/admin/php/",this.BODY=document.body,this.mw=null,this.inputFields=[],this.fileToSend=this.PATH}collectData(e){for(let t of e.attributes)"file"==t.name&&(this.fileToSend+=t.value);let t,n=Array.from(e.getElementsByTagName("input")),r=e.getElementsByTagName("textarea")[0].id;this.mw=e,r&&(t=document.getElementById(r),this.inputFields.push({type:"text",value:t.value,name:t.id}));for(let e of n)this.inputFields.push({type:e.type,value:e.value,name:e.id});this.inputIsCorrect()?this.send():this.onError("Incorrect input data")}inputIsCorrect(){let e=!0;for(let t of this.inputFields){let n=this.findMethodForChecking(t.type);e=e&&this.checkField(n,t.value)}return e}findMethodForChecking(e){switch(e){case"text":return this.ic.usualStringIsCorrect;case"url":return this.ic.urlIsCorrect;case"date":return this.ic.dateIsCorrect;default:return()=>!1}}checkField(e,t){try{if(!e(t))throw new Error(t);return!0}catch(e){return this.onError(e),!1}}send(){this.http.post(this.fileToSend,JSON.stringify(this.inputFields)).then(()=>{this.onSuccess()}).catch(e=>{this.onError(e)})}onSuccess(){alert("Successfully!"),this.BODY.removeChild(this.mw),this.destructor()}onError(e){alert(e),this.destructor()}destructor(){this.fileToSend=this.PATH,this.inputFields=[],this.mw=null}},c={el:"br"},d={el:"div",children:[{el:"i",event:"click",callBack:e=>i.delete(e.srcElement),options:[{name:"class",value:"fas fa-window-close closeBtn"}]},{el:"h2",text:"Добавление задания"},{el:"p",text:"Название: ",children:[{el:"input",options:[{name:"type",value:"text"},{name:"id",value:"nameOfTask"}]}]},{el:"p",text:"Дата сдачи: ",children:[{el:"input",options:[{name:"type",value:"date"},{name:"id",value:"dateToPass"}]}]},{el:"textarea",options:[{name:"id",value:"describtion"}]},c,{el:"i",event:"click",callBack:e=>o.insert(e.srcElement.parentElement),children:[{el:"i",options:[{name:"class",value:"fas fa-plus-circle"}]},{el:"span",text:"Добавить ссылку на картинку"}],options:[{name:"class",value:"add"}]},c,{el:"button",text:"Добавить",event:"click",callBack:e=>u.collectData(e.srcElement.parentElement),options:[{name:"id",value:"addTask"},{name:"class",value:"btn btn-success"}]},{el:"button",text:"Отмена",event:"click",callBack:e=>i.delete(e.srcElement),options:[{name:"id",value:"closeWindow"},{name:"class",value:"closeBtn"}]}],options:[{name:"class",value:"modalWindow"},{name:"file",value:"addTask.php"}]},p={el:"p",children:[{el:"input",options:[{name:"type",value:"url"},{name:"class",value:"urlToImg"},{name:"placeholder",value:"http://url.ru"}]},{el:"i",event:"click",callBack:e=>i.delete(e.srcElement),options:[{name:"class",value:"fas fa-trash-alt closeBtn"}]}]};window.onload=function(){let e=new l;document.getElementById("addTask").onclick=(()=>document.body.appendChild(e.generateElement(d)))}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2J0bi9idG4udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2h0bWwvZ2VuZXJhdG9yLnRzIiwid2VicGFjazovLy8uL3NyYy9pbnB1dC9pYy50cyIsIndlYnBhY2s6Ly8vLi9zcmMvaW5wdXQvaHR0cC50cyIsIndlYnBhY2s6Ly8vLi9zcmMvZGF0YS9zdHJ1Y3RzLnRzIiwid2VicGFjazovLy8uL3NyYy9idG4vY2xvc2VCdG4udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2J0bi9hZGRCdG4udHMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2lucHV0L2RtLnRzIiwid2VicGFjazovLy8uL3NyYy9pbmRleC50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIkJ0biIsIltvYmplY3QgT2JqZWN0XSIsInRoaXMiLCJidG4iLCJwYXJlbnROb2RlIiwiZ2V0UGFyZW50IiwiSHRtbEdlbmVyYXRvciIsImVsIiwibXciLCJnZW5lcmF0ZUJ5TmFtZU9mRWwiLCJjaGlsZHJlbiIsIm9wdCIsIm9wdGlvbnMiLCJzZXRBdHRyaWJ1dGUiLCJuYW1lT2ZFbCIsImVscyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImdldE1hcmt1cCIsImFwcGVuZENoaWxkIiwiZmxhZyIsIm1hcmt1cCIsImdlbmVyYXRlTWFya3VwIiwiY29udCIsImN1cnJlbnQiLCJuZXh0IiwiZG9uZSIsInB1c2giLCJlIiwiaXRlbSIsInByZXBhcmVDaGlsZE9mRWwiLCJjaGlsZCIsIml0ZW1UZXh0IiwiY3JlYXRlVGV4dE5vZGUiLCJ0ZXh0IiwiZXZlbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiY2FsbEJhY2siLCJJbnB1dENoZWNrZXIiLCJzdHIiLCJyZWciLCJyZXMiLCJsZXR0ZXIiLCJ0ZXN0IiwiZGF0ZSIsInVybCIsIkh0dHAiLCJmaWxlIiwiZGF0YSIsIm1ldGhvZCIsInNlbmRSZXF1ZXN0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJyZXNwb25zZSIsInhociIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsInNldFJlcXVlc3RIZWFkZXIiLCJzZW5kIiwib25yZWFkeXN0YXRlY2hhbmdlIiwicmVhZHlTdGF0ZSIsInN0YXR1cyIsIkpTT04iLCJwYXJzZSIsInJlc3BvbnNlVGV4dCIsImVycm9yTWVzc2FnZSIsImNiIiwiZ2V0R3JhbmQiLCJyZW1vdmVDaGlsZCIsImFiIiwic3VwZXIiLCJhcmd1bWVudHMiLCJnIiwiaW5zZXJ0QmVmb3JlIiwiZ2V0VXJsSW5wdXQiLCJBZGRVcmxJbnB1dENvbnQiLCJkbSIsImh0dHAiLCJpYyIsIlBBVEgiLCJsb2NhdGlvbiIsIm9yaWdpbiIsIkJPRFkiLCJib2R5IiwiaW5wdXRGaWVsZHMiLCJmaWxlVG9TZW5kIiwicGFyZW50IiwiYXR0ciIsImF0dHJpYnV0ZXMiLCJ0YSIsImlucHV0cyIsIkFycmF5IiwiZnJvbSIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwiaWRPZlRBIiwiaWQiLCJnZXRFbGVtZW50QnlJZCIsInR5cGUiLCJpbnB1dCIsImlucHV0SXNDb3JyZWN0Iiwib25FcnJvciIsInJlc3VsdCIsImZpZWxkIiwiZmluZE1ldGhvZEZvckNoZWNraW5nIiwiY2hlY2tGaWVsZCIsInVzdWFsU3RyaW5nSXNDb3JyZWN0IiwidXJsSXNDb3JyZWN0IiwiZGF0ZUlzQ29ycmVjdCIsImlzQ29ycmVjdCIsIkVycm9yIiwicG9zdCIsInN0cmluZ2lmeSIsInRoZW4iLCJvblN1Y2Nlc3MiLCJjYXRjaCIsImVycm9yIiwiYWxlcnQiLCJkZXN0cnVjdG9yIiwibWVzIiwiQnIiLCJBZGRUYXNrV2luZG93IiwiZGVsZXRlIiwic3JjRWxlbWVudCIsImluc2VydCIsInBhcmVudEVsZW1lbnQiLCJjb2xsZWN0RGF0YSIsIndpbmRvdyIsIm9ubG9hZCIsImdlbiIsIm9uY2xpY2siLCJnZW5lcmF0ZUVsZW1lbnQiXSwibWFwcGluZ3MiOiJhQUNBLElBQUFBLEtBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVBQUFFLEdBQUFDLFFBR0EsSUFBQUMsRUFBQUosRUFBQUUsSUFDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxZQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVBQUFELFFBQUFDLElBQUFELFFBQUFGLEdBR0FHLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUFLQUYsRUFBQVEsRUFBQUYsRUFHQU4sRUFBQVMsRUFBQVYsRUFHQUMsRUFBQVUsRUFBQSxTQUFBUixFQUFBUyxFQUFBQyxHQUNBWixFQUFBYSxFQUFBWCxFQUFBUyxJQUNBRyxPQUFBQyxlQUFBYixFQUFBUyxHQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBYixFQUFBaUIsT0FBQUMsYUFBd0RDLE1BQUEsV0FFeERQLE9BQUFDLGVBQUFiLEVBQUEsY0FBaURtQixPQUFBLEtBUWpEckIsRUFBQXNCLEVBQUEsU0FBQUQsRUFBQUUsR0FFQSxHQURBLEVBQUFBLElBQUFGLEVBQUFyQixFQUFBcUIsSUFDQSxFQUFBRSxFQUFBLE9BQUFGLEVBQ0EsS0FBQUUsR0FBQSxpQkFBQUYsUUFBQUcsV0FBQSxPQUFBSCxFQUNBLElBQUFJLEVBQUFYLE9BQUFZLE9BQUEs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LE1BQUEsaUJBb0JGMkYsR0FDUHJFLEdBQUEsSUFDQUcsV0FqQkFILEdBQUEsUUFDQUssVUFDU3JDLEtBQUEsT0FBQVUsTUFBQSxRQUNBVixLQUFBLFFBQUFVLE1BQUEsYUFDQVYsS0FBQSxjQUFBVSxNQUFBLG9CQUlUc0IsR0FBQSxJQUNBNEIsTUFBQSxRQUNBRSxTQUFBVCxHQUFBdUMsRUFBQXVELE9BQUE5RixFQUFBK0YsWUFDQS9HLFVBQ1NyQyxLQUFBLFFBQUFVLE1BQUEsaUNJckhUOEksT0FBQUMsT0FMQSxXQUNBLElBQUFDLEVBQUEsSUFBa0IzSCxFQUNsQlUsU0FBQWlGLGVBQUEsV0FDQWlDLFFBQUEsS0FBQWxILFNBQUFvRSxLQUFBakUsWUFBQThHLEVBQUFFLGdCQUF1RVYiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG4iLCJleHBvcnQgY2xhc3MgQnRuIHtcbiAgICBnZXRQYXJlbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJ0bi5wYXJlbnROb2RlO1xuICAgIH1cbiAgICBnZXRHcmFuZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UGFyZW50KCkucGFyZW50Tm9kZTtcbiAgICB9XG59XG4iLCJleHBvcnQgY2xhc3MgSHRtbEdlbmVyYXRvciB7XG4gICAgZ2VuZXJhdGVFbGVtZW50KGVsKSB7XG4gICAgICAgIGxldCBtdyA9IHRoaXMuZ2VuZXJhdGVCeU5hbWVPZkVsKGVsLmVsLCBlbC5jaGlsZHJlbik7XG4gICAgICAgIGZvciAobGV0IG9wdCBvZiBlbC5vcHRpb25zKSB7XG4gICAgICAgICAgICBtdy5zZXRBdHRyaWJ1dGUob3B0Lm5hbWUsIG9wdC52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG13O1xuICAgIH1cbiAgICBnZW5lcmF0ZUJ5TmFtZU9mRWwobmFtZU9mRWwsIGVscykge1xuICAgICAgICBsZXQgbXcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG5hbWVPZkVsKTtcbiAgICAgICAgZm9yIChsZXQgZWwgb2YgdGhpcy5nZXRNYXJrdXAoZWxzKSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBlbCAhPSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgbXcuYXBwZW5kQ2hpbGQoZWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtdztcbiAgICB9XG4gICAgZ2V0TWFya3VwKGVscykge1xuICAgICAgICBsZXQgZmxhZyA9IHRydWU7XG4gICAgICAgIGxldCBtYXJrdXAgPSB0aGlzLmdlbmVyYXRlTWFya3VwKGVscyk7XG4gICAgICAgIGxldCBjb250ID0gW107XG4gICAgICAgIHdoaWxlIChmbGFnKSB7XG4gICAgICAgICAgICBsZXQgY3VycmVudCA9IG1hcmt1cC5uZXh0KCk7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGZsYWcgPSAhY3VycmVudC5kb25lO1xuICAgICAgICAgICAgICAgIGNvbnQucHVzaChjdXJyZW50LnZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29udDtcbiAgICB9XG4gICAgKmdlbmVyYXRlTWFya3VwKGVscykge1xuICAgICAgICBmb3IgKGxldCBlbCBvZiBlbHMpIHtcbiAgICAgICAgICAgIGxldCBpdGVtID0gdGhpcy5wcmVwYXJlQ2hpbGRPZkVsKGVsKTtcbiAgICAgICAgICAgIGlmIChlbC5jaGlsZHJlbikge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGNoaWxkIG9mIGVsLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZW0uYXBwZW5kQ2hpbGQodGhpcy5wcmVwYXJlQ2hpbGRPZkVsKGNoaWxkKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgeWllbGQgaXRlbTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcmVwYXJlQ2hpbGRPZkVsKGNoaWxkKSB7XG4gICAgICAgIGxldCBpdGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChjaGlsZC5lbCksIGl0ZW1UZXh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoY2hpbGQudGV4dCA/IGNoaWxkLnRleHQgOiBcIlwiKSwgb3B0aW9ucyA9IGNoaWxkLm9wdGlvbnMgPyBjaGlsZC5vcHRpb25zIDogW107XG4gICAgICAgIGlmIChjaGlsZC50ZXh0KVxuICAgICAgICAgICAgaXRlbS5hcHBlbmRDaGlsZChpdGVtVGV4dCk7XG4gICAgICAgIGZvciAobGV0IG9wdCBvZiBvcHRpb25zKSB7XG4gICAgICAgICAgICBpdGVtLnNldEF0dHJpYnV0ZShvcHQubmFtZSwgb3B0LnZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY2hpbGQuZXZlbnQpXG4gICAgICAgICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoY2hpbGQuZXZlbnQsIGNoaWxkLmNhbGxCYWNrKTtcbiAgICAgICAgcmV0dXJuIGl0ZW07XG4gICAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIElucHV0Q2hlY2tlciB7XG4gICAgdXN1YWxTdHJpbmdJc0NvcnJlY3Qoc3RyKSB7XG4gICAgICAgIGxldCByZWcgPSAvW9CwLdGP0JAt0K9hLXpBLVowLTlcXHNcXC5cXCxdLztcbiAgICAgICAgbGV0IHJlcyA9IHRydWU7XG4gICAgICAgIGZvciAobGV0IGxldHRlciBvZiBzdHIpIHtcbiAgICAgICAgICAgIHJlcyA9IHJlcyAmJiByZWcudGVzdChsZXR0ZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfVxuICAgIGRhdGVJc0NvcnJlY3QoZGF0ZSkge1xuICAgICAgICBsZXQgcmVnID0gL1xcZHs0fVxcLVxcZHsxLDJ9XFwtXFxkezEsMn0vO1xuICAgICAgICByZXR1cm4gcmVnLnRlc3QoZGF0ZSk7XG4gICAgfVxuICAgIHVybElzQ29ycmVjdCh1cmwpIHtcbiAgICAgICAgbGV0IHJlZyA9IC9cXGIoPzooPzpodHRwcz98ZnRwKTpcXC9cXC98d3d3XFwuKVstYS16MC05KyZAI1xcLyU/PX5ffCE6LC47XSpbLWEtejAtOSsmQCNcXC8lPX5ffF0vaTtcbiAgICAgICAgcmV0dXJuIHJlZy50ZXN0KHVybCk7XG4gICAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIEh0dHAge1xuICAgIHBvc3QoZmlsZSwgZGF0YSkge1xuICAgICAgICBsZXQgciA9IHtcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICBmaWxlLFxuICAgICAgICAgICAgZGF0YVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGhpcy5zZW5kUmVxdWVzdChyKTtcbiAgICB9XG4gICAgZ2V0KGZpbGUsIGRhdGEpIHtcbiAgICAgICAgbGV0IHIgPSB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgICBmaWxlLFxuICAgICAgICAgICAgZGF0YVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gdGhpcy5zZW5kUmVxdWVzdChyKTtcbiAgICB9XG4gICAgc2VuZFJlcXVlc3Qocikge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpLCByZXNwb25zZTtcbiAgICAgICAgICAgIHhoci5vcGVuKHIubWV0aG9kLCByLmZpbGUpO1xuICAgICAgICAgICAgaWYgKHIubWV0aG9kID09IFwiUE9TVFwiKVxuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC10eXBlXCIsIFwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIpO1xuICAgICAgICAgICAgeGhyLnNlbmQoci5kYXRhKTtcbiAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09IDQgJiYgeGhyLnN0YXR1cyA9PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5lcnJvck1lc3NhZ2UgPyByZWplY3QocmVzcG9uc2UuZXJyb3JNZXNzYWdlKSA6IHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IENsb3NlQnRuIH0gZnJvbSAnLi4vYnRuL2Nsb3NlQnRuJztcbmltcG9ydCB7IEFkZExpbmtCdG4gfSBmcm9tICcuLi9idG4vYWRkQnRuJztcbmltcG9ydCB7IERhdGFNYW5hZ2VyIH0gZnJvbSAnLi4vaW5wdXQvZG0nO1xuY29uc3QgY2IgPSBuZXcgQ2xvc2VCdG4oKTtcbmNvbnN0IGFiID0gbmV3IEFkZExpbmtCdG4oKTtcbmNvbnN0IGRtID0gbmV3IERhdGFNYW5hZ2VyKCk7XG5jb25zdCBCciA9IHtcbiAgICBlbDogXCJiclwiXG59O1xuLy8gU3RydWN0dXJlIG9mIG1vZGFsIHdpbmRvd1xuY29uc3QgQ2xvc2VJY29uID0ge1xuICAgIGVsOiBcImlcIixcbiAgICBldmVudDogXCJjbGlja1wiLFxuICAgIGNhbGxCYWNrOiAoZSkgPT4gY2IuZGVsZXRlKGUuc3JjRWxlbWVudCksXG4gICAgb3B0aW9uczogW1xuICAgICAgICB7IG5hbWU6IFwiY2xhc3NcIiwgdmFsdWU6IFwiZmFzIGZhLXdpbmRvdy1jbG9zZSBjbG9zZUJ0blwiIH1cbiAgICBdXG59O1xuY29uc3QgSGVhZGVyID0ge1xuICAgIGVsOiBcImgyXCIsXG4gICAgdGV4dDogXCLQlNC+0LHQsNCy0LvQtdC90LjQtSDQt9Cw0LTQsNC90LjRj1wiXG59O1xuY29uc3QgTmFtZU9mVGFza0lucHV0ID0ge1xuICAgIGVsOiBcImlucHV0XCIsXG4gICAgb3B0aW9uczogW1xuICAgICAgICB7IG5hbWU6IFwidHlwZVwiLCB2YWx1ZTogXCJ0ZXh0XCIgfSxcbiAgICAgICAgeyBuYW1lOiBcImlkXCIsIHZhbHVlOiBcIm5hbWVPZlRhc2tcIiB9XG4gICAgXVxufTtcbmNvbnN0IE5hbWVPZlRhc2sgPSB7XG4gICAgZWw6IFwicFwiLFxuICAgIHRleHQ6IFwi0J3QsNC30LLQsNC90LjQtTogXCIsXG4gICAgY2hpbGRyZW46IFtOYW1lT2ZUYXNrSW5wdXRdXG59O1xuY29uc3QgRGF0ZVRvUGFzc0lucHV0ID0ge1xuICAgIGVsOiBcImlucHV0XCIsXG4gICAgb3B0aW9uczogW1xuICAgICAgICB7IG5hbWU6IFwidHlwZVwiLCB2YWx1ZTogXCJkYXRlXCIgfSxcbiAgICAgICAgeyBuYW1lOiBcImlkXCIsIHZhbHVlOiBcImRhdGVUb1Bhc3NcIiB9XG4gICAgXVxufTtcbmNvbnN0IERhdGVUb1Bhc3MgPSB7XG4gICAgZWw6IFwicFwiLFxuICAgIHRleHQ6IFwi0JTQsNGC0LAg0YHQtNCw0YfQuDogXCIsXG4gICAgY2hpbGRyZW46IFtEYXRlVG9QYXNzSW5wdXRdXG59O1xuY29uc3QgVGV4dEFyZWEgPSB7XG4gICAgZWw6IFwidGV4dGFyZWFcIixcbiAgICBvcHRpb25zOiBbXG4gICAgICAgIHsgbmFtZTogXCJpZFwiLCB2YWx1ZTogXCJkZXNjcmlidGlvblwiIH1cbiAgICBdXG59O1xuY29uc3QgQWRkSWNvbiA9IHtcbiAgICBlbDogXCJpXCIsXG4gICAgb3B0aW9uczogW1xuICAgICAgICB7IG5hbWU6IFwiY2xhc3NcIiwgdmFsdWU6IFwiZmFzIGZhLXBsdXMtY2lyY2xlXCIgfVxuICAgIF1cbn07XG5jb25zdCBTcGFuID0ge1xuICAgIGVsOiBcInNwYW5cIixcbiAgICB0ZXh0OiBcItCU0L7QsdCw0LLQuNGC0Ywg0YHRgdGL0LvQutGDINC90LAg0LrQsNGA0YLQuNC90LrRg1wiXG59O1xuY29uc3QgQWRkVXJsQnV0dG9uID0ge1xuICAgIGVsOiBcImlcIixcbiAgICBldmVudDogXCJjbGlja1wiLFxuICAgIGNhbGxCYWNrOiAoZSkgPT4gYWIuaW5zZXJ0KGUuc3JjRWxlbWVudC5wYXJlbnRFbGVtZW50KSxcbiAgICBjaGlsZHJlbjogW0FkZEljb24sIFNwYW5dLFxuICAgIG9wdGlvbnM6IFtcbiAgICAgICAgeyBuYW1lOiBcImNsYXNzXCIsIHZhbHVlOiBcImFkZFwiIH1cbiAgICBdXG59O1xuY29uc3QgQWRkQnV0dG9uID0ge1xuICAgIGVsOiBcImJ1dHRvblwiLFxuICAgIHRleHQ6IFwi0JTQvtCx0LDQstC40YLRjFwiLFxuICAgIGV2ZW50OiBcImNsaWNrXCIsXG4gICAgY2FsbEJhY2s6IChlKSA9PiBkbS5jb2xsZWN0RGF0YShlLnNyY0VsZW1lbnQucGFyZW50RWxlbWVudCksXG4gICAgb3B0aW9uczogW1xuICAgICAgICB7IG5hbWU6IFwiaWRcIiwgdmFsdWU6IFwiYWRkVGFza1wiIH0sXG4gICAgICAgIHsgbmFtZTogXCJjbGFzc1wiLCB2YWx1ZTogXCJidG4gYnRuLXN1Y2Nlc3NcIiB9XG4gICAgXVxufTtcbmNvbnN0IENsb3NlQnV0dG9uID0ge1xuICAgIGVsOiBcImJ1dHRvblwiLFxuICAgIHRleHQ6IFwi0J7RgtC80LXQvdCwXCIsXG4gICAgZXZlbnQ6IFwiY2xpY2tcIixcbiAgICBjYWxsQmFjazogKGUpID0+IGNiLmRlbGV0ZShlLnNyY0VsZW1lbnQpLFxuICAgIG9wdGlvbnM6IFtcbiAgICAgICAgeyBuYW1lOiBcImlkXCIsIHZhbHVlOiBcImNsb3NlV2luZG93XCIgfSxcbiAgICAgICAgeyBuYW1lOiBcImNsYXNzXCIsIHZhbHVlOiBcImNsb3NlQnRuXCIgfVxuICAgIF1cbn07XG5leHBvcnQgY29uc3QgQWRkVGFza1dpbmRvdyA9IHtcbiAgICBlbDogXCJkaXZcIixcbiAgICBjaGlsZHJlbjogW1xuICAgICAgICBDbG9zZUljb24sXG4gICAgICAgIEhlYWRlcixcbiAgICAgICAgTmFtZU9mVGFzayxcbiAgICAgICAgRGF0ZVRvUGFzcyxcbiAgICAgICAgVGV4dEFyZWEsXG4gICAgICAgIEJyLFxuICAgICAgICBBZGRVcmxCdXR0b24sXG4gICAgICAgIEJyLFxuICAgICAgICBBZGRCdXR0b24sXG4gICAgICAgIENsb3NlQnV0dG9uXG4gICAgXSxcbiAgICBvcHRpb25zOiBbXG4gICAgICAgIHsgbmFtZTogXCJjbGFzc1wiLCB2YWx1ZTogXCJtb2RhbFdpbmRvd1wiIH0sXG4gICAgICAgIHsgbmFtZTogXCJmaWxlXCIsIHZhbHVlOiBcImFkZFRhc2sucGhwXCIgfVxuICAgIF1cbn07XG4vLyBTdHJ1Y3R1cmUgb2YgaW5wdXQgZm9yIHVybFxuY29uc3QgQWRkVXJsSW5wdXQgPSB7XG4gICAgZWw6IFwiaW5wdXRcIixcbiAgICBvcHRpb25zOiBbXG4gICAgICAgIHsgbmFtZTogXCJ0eXBlXCIsIHZhbHVlOiBcInVybFwiIH0sXG4gICAgICAgIHsgbmFtZTogXCJjbGFzc1wiLCB2YWx1ZTogXCJ1cmxUb0ltZ1wiIH0sXG4gICAgICAgIHsgbmFtZTogXCJwbGFjZWhvbGRlclwiLCB2YWx1ZTogXCJodHRwOi8vdXJsLnJ1XCIgfVxuICAgIF1cbn07XG5jb25zdCBEZWxJY29uID0ge1xuICAgIGVsOiBcImlcIixcbiAgICBldmVudDogXCJjbGlja1wiLFxuICAgIGNhbGxCYWNrOiAoZSkgPT4gY2IuZGVsZXRlKGUuc3JjRWxlbWVudCksXG4gICAgb3B0aW9uczogW1xuICAgICAgICB7IG5hbWU6IFwiY2xhc3NcIiwgdmFsdWU6IFwiZmFzIGZhLXRyYXNoLWFsdCBjbG9zZUJ0blwiIH1cbiAgICBdXG59O1xuZXhwb3J0IGNvbnN0IEFkZFVybElucHV0Q29udCA9IHtcbiAgICBlbDogXCJwXCIsXG4gICAgY2hpbGRyZW46IFtBZGRVcmxJbnB1dCwgRGVsSWNvbl1cbn07XG4iLCJpbXBvcnQgeyBCdG4gfSBmcm9tIFwiLi9idG5cIjtcbmV4cG9ydCBjbGFzcyBDbG9zZUJ0biBleHRlbmRzIEJ0biB7XG4gICAgZGVsZXRlKGJ0bikge1xuICAgICAgICB0aGlzLmJ0biA9IGJ0bjtcbiAgICAgICAgdGhpcy5nZXRHcmFuZCgpLnJlbW92ZUNoaWxkKHRoaXMuZ2V0UGFyZW50KCkpO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEJ0biB9IGZyb20gXCIuL2J0blwiO1xuaW1wb3J0IHsgSHRtbEdlbmVyYXRvciB9IGZyb20gJy4uL2h0bWwvZ2VuZXJhdG9yJztcbmltcG9ydCB7IEFkZFVybElucHV0Q29udCB9IGZyb20gJy4uL2RhdGEvc3RydWN0cyc7XG5leHBvcnQgY2xhc3MgQWRkTGlua0J0biBleHRlbmRzIEJ0biB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG4gICAgICAgIHRoaXMuZyA9IG5ldyBIdG1sR2VuZXJhdG9yKCk7XG4gICAgfVxuICAgIGluc2VydChidG4pIHtcbiAgICAgICAgdGhpcy5idG4gPSBidG47XG4gICAgICAgIHRoaXMuZ2V0UGFyZW50KCkuaW5zZXJ0QmVmb3JlKHRoaXMuZ2V0VXJsSW5wdXQoKSwgdGhpcy5idG4pO1xuICAgIH1cbiAgICBnZXRVcmxJbnB1dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZy5nZW5lcmF0ZUJ5TmFtZU9mRWwoQWRkVXJsSW5wdXRDb250LmVsLCBBZGRVcmxJbnB1dENvbnQuY2hpbGRyZW4pO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IElucHV0Q2hlY2tlciB9IGZyb20gJy4vaWMnO1xuaW1wb3J0IHsgSHR0cCB9IGZyb20gJy4vaHR0cCc7XG5leHBvcnQgY2xhc3MgRGF0YU1hbmFnZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmh0dHAgPSBuZXcgSHR0cCgpO1xuICAgICAgICB0aGlzLmljID0gbmV3IElucHV0Q2hlY2tlcigpO1xuICAgICAgICB0aGlzLlBBVEggPSBkb2N1bWVudC5sb2NhdGlvbi5vcmlnaW4gKyBcIi9hZG1pbi9waHAvXCI7XG4gICAgICAgIHRoaXMuQk9EWSA9IGRvY3VtZW50LmJvZHk7XG4gICAgICAgIHRoaXMubXcgPSBudWxsO1xuICAgICAgICB0aGlzLmlucHV0RmllbGRzID0gW107XG4gICAgICAgIHRoaXMuZmlsZVRvU2VuZCA9IHRoaXMuUEFUSDtcbiAgICB9XG4gICAgY29sbGVjdERhdGEocGFyZW50KSB7XG4gICAgICAgIGZvciAobGV0IGF0dHIgb2YgcGFyZW50LmF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgIGlmIChhdHRyLm5hbWUgPT0gXCJmaWxlXCIpXG4gICAgICAgICAgICAgICAgdGhpcy5maWxlVG9TZW5kICs9IGF0dHIudmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGlucHV0cyA9IEFycmF5LmZyb20ocGFyZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaW5wdXRcIikpO1xuICAgICAgICBsZXQgaWRPZlRBID0gcGFyZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwidGV4dGFyZWFcIilbMF0uaWQ7XG4gICAgICAgIHRoaXMubXcgPSBwYXJlbnQ7XG4gICAgICAgIGxldCB0YTtcbiAgICAgICAgaWYgKGlkT2ZUQSkge1xuICAgICAgICAgICAgdGEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZE9mVEEpO1xuICAgICAgICAgICAgdGhpcy5pbnB1dEZpZWxkcy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcInRleHRcIixcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGEudmFsdWUsXG4gICAgICAgICAgICAgICAgbmFtZTogdGEuaWRcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGZvciAobGV0IGlucHV0IG9mIGlucHV0cykge1xuICAgICAgICAgICAgdGhpcy5pbnB1dEZpZWxkcy5wdXNoKHtcbiAgICAgICAgICAgICAgICB0eXBlOiBpbnB1dC50eXBlLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBpbnB1dC52YWx1ZSxcbiAgICAgICAgICAgICAgICBuYW1lOiBpbnB1dC5pZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaW5wdXRJc0NvcnJlY3QoKSlcbiAgICAgICAgICAgIHRoaXMuc2VuZCgpO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICB0aGlzLm9uRXJyb3IoXCJJbmNvcnJlY3QgaW5wdXQgZGF0YVwiKTtcbiAgICB9XG4gICAgaW5wdXRJc0NvcnJlY3QoKSB7XG4gICAgICAgIGxldCByZXN1bHQgPSB0cnVlO1xuICAgICAgICBmb3IgKGxldCBmaWVsZCBvZiB0aGlzLmlucHV0RmllbGRzKSB7XG4gICAgICAgICAgICBsZXQgbWV0aG9kID0gdGhpcy5maW5kTWV0aG9kRm9yQ2hlY2tpbmcoZmllbGQudHlwZSk7XG4gICAgICAgICAgICByZXN1bHQgPSByZXN1bHQgJiYgdGhpcy5jaGVja0ZpZWxkKG1ldGhvZCwgZmllbGQudmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIGZpbmRNZXRob2RGb3JDaGVja2luZyh0eXBlKSB7XG4gICAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcInRleHRcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pYy51c3VhbFN0cmluZ0lzQ29ycmVjdDtcbiAgICAgICAgICAgIGNhc2UgXCJ1cmxcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5pYy51cmxJc0NvcnJlY3Q7XG4gICAgICAgICAgICBjYXNlIFwiZGF0ZVwiOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmljLmRhdGVJc0NvcnJlY3Q7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiAoKSA9PiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjaGVja0ZpZWxkKGlzQ29ycmVjdCwgdmFsdWUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghaXNDb3JyZWN0KHZhbHVlKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcih2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhpcy5vbkVycm9yKGUpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNlbmQoKSB7XG4gICAgICAgIHRoaXMuaHR0cC5wb3N0KHRoaXMuZmlsZVRvU2VuZCwgSlNPTi5zdHJpbmdpZnkodGhpcy5pbnB1dEZpZWxkcykpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm9uU3VjY2VzcygpO1xuICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgdGhpcy5vbkVycm9yKGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIG9uU3VjY2VzcygpIHtcbiAgICAgICAgYWxlcnQoXCJTdWNjZXNzZnVsbHkhXCIpO1xuICAgICAgICB0aGlzLkJPRFkucmVtb3ZlQ2hpbGQodGhpcy5tdyk7XG4gICAgICAgIHRoaXMuZGVzdHJ1Y3RvcigpO1xuICAgIH1cbiAgICBvbkVycm9yKG1lcykge1xuICAgICAgICBhbGVydChtZXMpO1xuICAgICAgICB0aGlzLmRlc3RydWN0b3IoKTtcbiAgICB9XG4gICAgZGVzdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5maWxlVG9TZW5kID0gdGhpcy5QQVRIO1xuICAgICAgICB0aGlzLmlucHV0RmllbGRzID0gW107XG4gICAgICAgIHRoaXMubXcgPSBudWxsO1xuICAgIH1cbn1cbiIsImltcG9ydCB7IEFkZFRhc2tXaW5kb3cgfSBmcm9tICcuL2RhdGEvc3RydWN0cyc7XG5pbXBvcnQgeyBIdG1sR2VuZXJhdG9yIH0gZnJvbSAnLi9odG1sL2dlbmVyYXRvcic7XG5mdW5jdGlvbiBtYWluKCkge1xuICAgIGxldCBnZW4gPSBuZXcgSHRtbEdlbmVyYXRvcigpO1xuICAgIGxldCBvcGVuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhZGRUYXNrXCIpO1xuICAgIG9wZW4ub25jbGljayA9ICgpID0+IGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZ2VuLmdlbmVyYXRlRWxlbWVudChBZGRUYXNrV2luZG93KSk7XG59XG53aW5kb3cub25sb2FkID0gbWFpbjtcbiJdLCJzb3VyY2VSb290IjoiIn0=